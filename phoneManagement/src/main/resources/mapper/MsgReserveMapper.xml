<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.momo.mapper.MsgReserveMapper">

    <select id="getReservedMessageByBno">
        select
            s.shop_cd as shop_cd,
            s.shop_nm as shop_nm,
            mr.sale_no as sale_no,
            mr.send_tp as send_tp,
            mr.send_st as send_st,
            mr.cust_nm as cust_nm,
            mr.cust_tel as cust_tel,
            mr.content as content,
            mr.seller_id as seller_id,
            a.name as seller_nm,
            mr.rsv_dt as rsv_dt,
            mr.regi_dt as regi_dt
        from
            tb_msg_rsv mr
                left outer join tb_shop s on mr.shop_cd=s.shop_cd
        left outer join tb_account a on mr.seller_id=a.id
        where
            s.b_no=#{bNo}
    </select>
    
    <select id="search" parameterType="com.momo.vo.SearchVO">
        with tb as (
            select
            s.shop_cd as shop_cd,
            s.shop_nm as shop_nm,
            mr.sale_no as sale_no,
            mr.send_tp as send_tp,
            mr.send_st as send_st,
            mr.cust_nm as cust_nm,
            mr.cust_tel as cust_tel,
            mr.content as content,
            mr.seller_id as seller_id,
            a.name as seller_nm,
            mr.rsv_dt as rsv_dt,
            mr.regi_dt as regi_dt
            from
            tb_msg_rsv mr
            left outer join tb_shop s on mr.shop_cd=s.shop_cd
            left outer join tb_account a on mr.seller_id=a.id
        )

        select
            *
        from
            tb
        where
            ${orSearch} and
            ${andSelect}
        ${prop}

    </select>

    <select id="getMaxMsgId">
        select
            count(*)
        from
            tb_msg_rsv
        where
            shop_cd=#{shopCd}
    </select>

    <insert id="insert" parameterMap="java.util.Map">
        insert into
        tb_msg_rsv
        (msg_id, shop_cd, send_tp, cust_nm, cust_tel, content, seller_id, rsv_dt)
        values
            (#{msg_id},#{shop_cd},#{send_tp},#{cust_nm},#{cust_tel},#{content},#{seller_id},#{rsv_dt})
    </insert>

    <select id="select">
        select
        s.shop_cd as shop_cd,
        s.shop_nm as shop_nm,
        mr.sale_no as sale_no,
        mr.send_tp as send_tp,
        mr.send_st as send_st,
        mr.cust_nm as cust_nm,
        mr.cust_tel as cust_tel,
        mr.content as content,
        mr.seller_id as seller_id,
        a.name as seller_nm,
        mr.rsv_dt as rsv_dt,
        mr.regi_dt as regi_dt
        from
            tb_msg_rsv mr
        left outer join tb_shop s on mr.shop_cd=s.shop_cd
        left outer join tb_account a on mr.seller_id=a.id
        where
            ${qs}
    </select>

    <update id="update" parameterMap="java.util.Map">
        update
            tb_msg_rsv
        set
            cust_nm=#{cust_nm},
            cust_tel=#{cust_tel},
            content=#{content},
            rsv_dt=#{rsv_dt}
        where
            msg_id=#{msg_id}
    </update>

    <delete id="delete" parameterMap="java.util.Map">
        delete from
                   tb_msg_rsv
        where
            msg_id=#{msg_id}
    </delete>

</mapper>